<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="upgrade-insecure-requests"
    />
    <title>用户中心 - 智能对话系统</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Font Awesome -->
    <link
      href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"
      rel="stylesheet"
    />

    <!-- 配置 Tailwind CSS -->
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#4F46E5",
              secondary: "#F3F4F6",
              neutral: "#1F2937",
              "neutral-light": "#F9FAFB",
              "border-color": "#E5E7EB",
            },
            fontFamily: {
              sans: ["Inter", "system-ui", "sans-serif"],
            },
          },
        },
      };
    </script>

    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
      @layer utilities {
        .content-auto {
          content-visibility: auto;
        }
        .card-rounded {
          border-radius: 1rem;
        }
        .form-input-focus {
          @apply focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary;
        }
        .btn-primary {
          @apply bg-primary text-white py-3 px-4 rounded-lg font-medium hover:bg-primary/90 transition-colors duration-200;
        }
        .btn-secondary {
          @apply bg-white border border-border-color py-3 px-4 rounded-lg font-medium hover:bg-gray-50 transition-colors duration-200;
        }
        .btn-danger {
          @apply bg-white border border-red-200 text-red-600 py-3 px-4 rounded-lg font-medium hover:bg-red-50 transition-colors duration-200;
        }
      }
    </style>

    <!-- 深色模式样式 -->
    <style>
      .dark {
        background-color: #1a1a1a;
        color: #f0f0f0;
      }
      .dark .bg-white {
        background-color: #2d2d2d !important;
      }
      .dark .bg-gray-50 {
        background-color: #1a1a1a !important;
      }
      .dark .text-neutral {
        color: #f0f0f0 !important;
      }
      .dark .text-gray-500 {
        color: #a0a0a0 !important;
      }
      .dark .text-gray-600 {
        color: #b0b0b0 !important;
      }
      .dark .text-gray-700 {
        color: #c0c0c0 !important;
      }
      .dark .text-gray-800 {
        color: #d0d0d0 !important;
      }
      .dark .border-border-color {
        border-color: #404040 !important;
      }
      .dark .text-gray-700 {
        color: #d1d5db !important;
      }
      .dark .text-gray-500 {
        color: #9ca3af !important;
      }
      .dark .text-neutral {
        color: #f0f0f0 !important;
      }
      .dark .border-red-200 {
        border-color: #8b0000 !important;
      }
      .dark .hover\:bg-gray-100:hover {
        background-color: #333333 !important;
      }
      .dark .hover\:bg-gray-50:hover {
        background-color: #2a2a2a !important;
      }
      .dark .hover\:bg-red-50:hover {
        background-color: #3a0a0a !important;
      }
      .dark #password-modal .bg-white {
        background-color: #2d2d2d !important;
      }
      .dark #password-modal .text-neutral {
        color: #f0f0f0 !important;
      }
      .dark #password-modal .text-gray-700 {
        color: #d1d5db !important;
      }
      .dark #password-modal .text-gray-500 {
        color: #9ca3af !important;
      }
      .dark #password-modal .border-border-color {
        border-color: #404040 !important;
      }
      .dark #success-toast {
        background-color: #1a3a1a !important;
        border-color: #2d5a2d !important;
        color: #86efac !important;
      }
      .dark #error-toast {
        background-color: #3a1a1a !important;
        border-color: #5a2d2d !important;
        color: #fca5a5 !important;
      }
      .dark .bg-red-50 {
        background-color: #3a0a0a !important;
      }
      .dark .border-red-200 {
        border-color: #8b0000 !important;
      }
      .dark .text-red-600 {
        color: #f87171 !important;
      }
      .dark .bg-gray-50 {
        background-color: #1a1a1a !important;
      }
      .dark body {
        background-color: #1a1a1a !important;
      }
      .dark .bg-white {
        background-color: #2d2d2d !important;
      }
      .dark .border-border-color {
        border-color: #404040 !important;
      }
      .dark .hover\:text-primary:hover {
        color: #6366f1 !important;
      }
      .dark input,
      .dark input:focus,
      .dark select,
      .dark select:focus {
        background-color: #333333 !important;
        color: #f0f0f0 !important;
        border-color: #404040 !important;
      }
      .dark input::placeholder {
        color: #9ca3af !important;
      }
      .dark .fa {
        color: #a0a0a0 !important;
      }
      .dark .fa-user {
        color: #ffffff !important;
      }
      .dark .bg-black\/50 {
        background-color: rgba(0, 0, 0, 0.7) !important;
      }
      .dark .bg-green-50 {
        background-color: #0a2e0a !important;
      }
      .dark .bg-red-50 {
        background-color: #3a0a0a !important;
      }
      .dark .border-green-200 {
        border-color: #0a4d0a !important;
      }
      .dark .text-green-700 {
        color: #4ade80 !important;
      }
      .dark .text-red-700 {
        color: #f87171 !important;
      }
      .dark .bg-gray-50 {
        background-color: #1a1a1a !important;
      }
      .dark .btn-secondary {
        background-color: #333333 !important;
        border-color: #404040 !important;
        color: #f0f0f0 !important;
      }
      .dark .btn-danger {
        background-color: #333333 !important;
        border-color: #8b0000 !important;
        color: #f87171 !important;
      }
      .dark .hover\:bg-gray-50:hover {
        background-color: #2a2a2a !important;
      }
      .dark .hover\:bg-red-50:hover {
        background-color: #3a0a0a !important;
      }
      .dark .hover\:text-gray-700:hover {
        color: #d1d5db !important;
      }
      .dark body {
        background-color: #1a1a1a !important;
      }
      .dark .bg-gray-50 {
        background-color: #1a1a1a !important;
      }
      body.dark {
        background-color: #1a1a1a !important;
      }
      body.dark .bg-gray-50 {
        background-color: #1a1a1a !important;
      }
      html.dark body {
        background-color: #1a1a1a !important;
      }
      html.dark .bg-gray-50 {
        background-color: #1a1a1a !important;
      }
    </style>
  </head>
  <body
    class="bg-gray-50 font-sans text-neutral min-h-screen flex items-center justify-center p-4"
  >
    <!-- 返回按钮 -->
    <a
      href="index.html"
      class="fixed top-4 left-4 text-gray-500 hover:text-primary transition-colors duration-200"
    >
      <i class="fa fa-arrow-left text-lg"></i>
    </a>

    <!-- 用户中心主容器 -->
    <div class="w-full max-w-md">
      <!-- 用户信息头部 -->
      <div class="flex items-center justify-center mb-8">
        <div
          class="w-16 h-16 bg-primary rounded-full flex items-center justify-center mr-4"
        >
          <i class="fa fa-user text-white text-2xl"></i>
        </div>
        <h1 class="text-2xl font-bold text-neutral">我的昵称</h1>
      </div>

      <!-- 用户中心卡片 -->
      <div
        class="bg-white shadow-lg p-6 card-rounded border border-border-color"
      >
        <!-- 昵称设置 -->
        <div class="mb-6">
          <label
            for="nickname"
            class="block text-sm font-medium text-gray-700 mb-2"
            >昵称：</label
          >
          <div class="flex space-x-2">
            <input
              type="text"
              id="nickname"
              value="我的昵称"
              class="flex-1 px-4 py-3 border border-border-color rounded-lg form-input-focus transition-all duration-200"
              placeholder="请输入昵称"
            />
            <button id="save-nickname" class="btn-primary px-4 py-3">
              <i class="fa fa-save mr-2"></i>
              保存
            </button>
          </div>
        </div>

        <!-- 更改密码按钮 -->
        <button
          id="change-password-btn"
          class="w-full btn-secondary mb-4 flex items-center justify-center hover:bg-gray-50 transition-colors duration-200"
        >
          <i class="fa fa-lock mr-2"></i>
          更改密码
        </button>

        <!-- 删除账户按钮 -->
        <button
          id="delete-account"
          class="w-full btn-danger mb-4 flex items-center justify-center"
        >
          <i class="fa fa-trash mr-2"></i>
          删除账户
        </button>

        <!-- 退出登录按钮 -->
        <button
          id="logout-btn"
          class="w-full btn-danger flex items-center justify-center"
        >
          <i class="fa fa-sign-out mr-2"></i>
          退出登录
        </button>
      </div>
    </div>

    <!-- 更改密码模态框 -->
    <div
      id="password-modal"
      class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden"
    >
      <div
        class="bg-white rounded-lg p-6 w-full max-w-md mx-4 transform transition-all duration-300 scale-95 opacity-0"
        id="modal-content"
      >
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-bold text-neutral">更改密码</h3>
          <button id="close-modal" class="text-gray-500 hover:text-gray-700">
            <i class="fa fa-times"></i>
          </button>
        </div>

        <form id="password-form">
          <div class="mb-4">
            <label
              for="current-password"
              class="block text-sm font-medium text-gray-700 mb-1"
              >当前密码</label
            >
            <input
              type="password"
              id="current-password"
              class="w-full px-4 py-2 border border-border-color rounded-lg form-input-focus"
              placeholder="请输入当前密码"
              required
            />
          </div>

          <div class="mb-4">
            <label
              for="new-password"
              class="block text-sm font-medium text-gray-700 mb-1"
              >新密码</label
            >
            <input
              type="password"
              id="new-password"
              class="w-full px-4 py-2 border border-border-color rounded-lg form-input-focus"
              placeholder="请输入新密码"
              required
            />
            <p class="text-xs text-gray-500 mt-1">密码长度至少8位</p>
          </div>

          <div class="mb-6">
            <label
              for="confirm-password"
              class="block text-sm font-medium text-gray-700 mb-1"
              >确认新密码</label
            >
            <input
              type="password"
              id="confirm-password"
              class="w-full px-4 py-2 border border-border-color rounded-lg form-input-focus"
              placeholder="请再次输入新密码"
              required
            />
          </div>

          <div class="flex space-x-3">
            <button
              type="button"
              id="cancel-change"
              class="flex-1 btn-secondary"
            >
              取消
            </button>
            <button type="submit" class="flex-1 btn-primary">确认更改</button>
          </div>
        </form>
      </div>
    </div>

    <!-- 成功提示 -->
    <div
      id="success-toast"
      class="fixed bottom-4 right-4 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg shadow-lg flex items-center transform translate-y-10 opacity-0 transition-all duration-300 z-50"
    >
      <i class="fa fa-check-circle mr-2 text-green-500"></i>
      <span id="toast-message">操作成功！</span>
    </div>

    <!-- 错误提示 -->
    <div
      id="error-toast"
      class="fixed bottom-4 right-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg shadow-lg flex items-center transform translate-y-10 opacity-0 transition-all duration-300 z-50"
    >
      <i class="fa fa-times-circle mr-2 text-red-500"></i>
      <span id="error-message">暂不支持此语言</span>
    </div>

    <!-- JavaScript 逻辑 -->
    <script>
      // 全局变量
      let apiBaseUrl = "http://8.141.14.50:3000"; // 后端服务器地址

      document.addEventListener("DOMContentLoaded", async function () {
        // 检查用户是否已登录
        const token = localStorage.getItem("authToken");

        if (!token) {
          // 用户未登录，重定向到登录页面
          window.location.href = "login.html";
          return;
        }

        // 验证token并获取用户信息
        try {
          const response = await fetch(`${apiBaseUrl}/api/auth/verify`, {
            method: "GET",
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });

          if (!response.ok) {
            // Token无效，清除并重定向到登录页面
            localStorage.removeItem("authToken");
            localStorage.removeItem("userNickname");
            localStorage.removeItem("currentUser");
            localStorage.removeItem("userLoggedIn");
            window.location.href = "login.html";
            return;
          }

          const userData = await response.json();

          // 更新用户信息显示
          const nicknameInput = document.getElementById("nickname");
          const nicknameHeader = document.querySelector(
            "h1.text-2xl.font-bold.text-neutral",
          );

          if (nicknameInput) {
            nicknameInput.value =
              userData.user.nickname || userData.user.username;
          }

          if (nicknameHeader) {
            nicknameHeader.textContent =
              userData.user.nickname || userData.user.username;
          }

          // 更新localStorage
          localStorage.setItem("userNickname", userData.user.nickname || "");
          localStorage.setItem("currentUser", userData.user.username || "");
          localStorage.setItem("userLoggedIn", "true");

          // 保存原始昵称，用于检测变化
          let originalNickname = nicknameInput ? nicknameInput.value : "";
        } catch (error) {
          console.error("获取用户信息时出错:", error);
          // 出错时清除并重定向到登录页面
          localStorage.removeItem("authToken");
          localStorage.removeItem("userNickname");
          localStorage.removeItem("currentUser");
          localStorage.removeItem("userLoggedIn");
          window.location.href = "login.html";
          return;
        }

        // 初始化深色模式
        initDarkMode();

        // 获取DOM元素
        const changePasswordBtn = document.getElementById(
          "change-password-btn",
        );
        const logoutBtn = document.getElementById("logout-btn");
        const deleteAccountBtn = document.getElementById("delete-account");
        const passwordModal = document.getElementById("password-modal");
        const modalContent = document.getElementById("modal-content");
        const closeModal = document.getElementById("close-modal");
        const cancelChange = document.getElementById("cancel-change");
        const passwordForm = document.getElementById("password-form");
        const successToast = document.getElementById("success-toast");
        const errorToast = document.getElementById("error-toast");
        const toastMessage = document.getElementById("toast-message");
        const errorMessage = document.getElementById("error-message");
        const saveNicknameBtn = document.getElementById("save-nickname");

        // 重新获取昵称相关元素和原始昵称值
        const nicknameInput = document.getElementById("nickname");
        const nicknameHeader = document.querySelector(
          "h1.text-2xl.font-bold.text-neutral",
        );
        let originalNickname = nicknameInput ? nicknameInput.value : "";

        // 更改密码按钮点击事件
        if (changePasswordBtn) {
          changePasswordBtn.addEventListener("click", function () {
            openModal();
          });
        }

        // 关闭模态框的函数
        function closeModalFunc() {
          passwordModal.classList.add("hidden");
          modalContent.classList.remove("scale-100", "opacity-100");
          modalContent.classList.add("scale-95", "opacity-0");
          // 重置表单
          if (passwordForm) {
            passwordForm.reset();
            // 清除可能的错误样式
            document
              .querySelectorAll("#password-form input")
              .forEach((input) => {
                input.classList.remove("border-red-500");
              });
          }
        }

        // 打开模态框的函数
        function openModal() {
          passwordModal.classList.remove("hidden");
          // 触发重排以允许动画生效
          void modalContent.offsetWidth;
          modalContent.classList.remove("scale-95", "opacity-0");
          modalContent.classList.add("scale-100", "opacity-100");
        }

        // 关闭模态框按钮点击事件
        if (closeModal) {
          closeModal.addEventListener("click", closeModalFunc);
        }

        // 取消更改按钮点击事件
        if (cancelChange) {
          cancelChange.addEventListener("click", closeModalFunc);
        }

        // 点击模态框外部关闭
        if (passwordModal) {
          passwordModal.addEventListener("click", function (e) {
            if (e.target === passwordModal) {
              closeModalFunc();
            }
          });
        }

        // 按ESC键关闭模态框
        document.addEventListener("keydown", function (e) {
          if (
            e.key === "Escape" &&
            !passwordModal.classList.contains("hidden")
          ) {
            closeModalFunc();
          }
        });

        // 显示成功提示
        function showToast(message) {
          toastMessage.textContent = message;
          successToast.classList.remove("translate-y-10", "opacity-0");
          successToast.classList.add("translate-y-0", "opacity-100");

          // 3秒后自动隐藏
          setTimeout(() => {
            successToast.classList.remove("translate-y-0", "opacity-100");
            successToast.classList.add("translate-y-10", "opacity-0");
          }, 3000);
        }

        // 显示错误提示
        function showErrorToast(message) {
          errorMessage.textContent = message;
          errorToast.classList.remove("translate-y-10", "opacity-0");
          errorToast.classList.add("translate-y-0", "opacity-100");

          // 3秒后自动隐藏
          setTimeout(() => {
            errorToast.classList.remove("translate-y-0", "opacity-100");
            errorToast.classList.add("translate-y-10", "opacity-0");
          }, 3000);
        }

        // 退出登录按钮点击事件
        if (logoutBtn) {
          logoutBtn.addEventListener("click", async function () {
            if (confirm("确定要退出登录吗？")) {
              try {
                // 检查是否有临时对话需要保存
                const hasTempConversation =
                  localStorage.getItem("hasTempConversation") === "true";
                const tempConversationData =
                  localStorage.getItem("tempConversation");

                if (hasTempConversation && tempConversationData) {
                  try {
                    const tempConversation = JSON.parse(tempConversationData);
                    if (
                      tempConversation.messages &&
                      tempConversation.messages.length > 0
                    ) {
                      // 获取认证token
                      const token = localStorage.getItem("authToken");
                      if (token) {
                        // 生成对话标题（使用第一条用户消息的前30个字符）
                        const title =
                          tempConversation.messages
                            .find((msg) => msg.role === "user")
                            ?.content.substring(0, 30) + "..." || "新对话";

                        // 创建新对话
                        const response = await fetch(
                          `${apiBaseUrl}/api/conversations`,
                          {
                            method: "POST",
                            headers: {
                              "Content-Type": "application/json",
                              Authorization: `Bearer ${token}`,
                            },
                            body: JSON.stringify({
                              title,
                              messages: tempConversation.messages,
                            }),
                          },
                        );

                        if (response.ok) {
                          console.log("退出登录前已保存临时对话");
                        } else {
                          console.error("保存临时对话失败");
                        }
                      }
                    }
                  } catch (error) {
                    console.error("处理临时对话时出错:", error);
                    // 即使出错也继续退出流程
                  }
                }

                // 清除登录状态
                localStorage.removeItem("userLoggedIn");
                localStorage.removeItem("currentUser");
                localStorage.removeItem("userNickname");
                localStorage.removeItem("authToken");

                // 清除临时对话记录（已保存到数据库）
                localStorage.removeItem("tempConversation");
                localStorage.removeItem("hasTempConversation");
                localStorage.removeItem("lastViewedConversation");

                // 跳转到登录页面
                window.location.href = "login.html";
              } catch (error) {
                console.error("退出登录时出错:", error);
                // 即使出错也继续退出流程
                window.location.href = "login.html";
              }
            }
          });
        }

        // 删除账户按钮点击事件
        if (deleteAccountBtn) {
          deleteAccountBtn.addEventListener("click", async function () {
            // 显示确认对话框
            if (confirm("确定要删除账户吗？此操作不可撤销。")) {
              try {
                // 调用后端API删除账户
                const token = localStorage.getItem("authToken");
                const response = await fetch(
                  `${apiBaseUrl}/api/auth/delete-account`,
                  {
                    method: "DELETE",
                    headers: {
                      Authorization: `Bearer ${token}`,
                    },
                  },
                );

                if (response.ok) {
                  // 清除本地存储的认证信息
                  localStorage.removeItem("authToken");
                  localStorage.removeItem("userLoggedIn");
                  localStorage.removeItem("currentUser");
                  localStorage.removeItem("userNickname");

                  // 清除临时对话记录
                  localStorage.removeItem("tempConversation");
                  localStorage.removeItem("hasTempConversation");
                  localStorage.removeItem("lastViewedConversation");

                  // 跳转到注册页面
                  window.location.href = "register.html";
                } else {
                  const data = await response.json();
                  alert(data.message || "删除账户失败");
                }
              } catch (error) {
                console.error("删除账户时出错:", error);
                alert("删除账户时发生错误，请稍后再试");
              }
            }
          });
        }

        // 密码表单提交事件
        if (passwordForm) {
          passwordForm.addEventListener("submit", function (e) {
            e.preventDefault();

            const currentPassword =
              document.getElementById("current-password").value;
            const newPassword = document.getElementById("new-password").value;
            const confirmPassword =
              document.getElementById("confirm-password").value;

            // 简单的表单验证
            let isValid = true;

            // 验证当前密码
            if (!currentPassword) {
              document
                .getElementById("current-password")
                .classList.add("border-red-500");
              isValid = false;
            } else {
              document
                .getElementById("current-password")
                .classList.remove("border-red-500");
            }

            // 验证新密码
            if (!newPassword || newPassword.length < 8) {
              document
                .getElementById("new-password")
                .classList.add("border-red-500");
              isValid = false;
            } else {
              document
                .getElementById("new-password")
                .classList.remove("border-red-500");
            }

            // 验证确认密码
            if (newPassword !== confirmPassword) {
              document
                .getElementById("confirm-password")
                .classList.add("border-red-500");
              isValid = false;
            } else {
              document
                .getElementById("confirm-password")
                .classList.remove("border-red-500");
            }

            if (isValid) {
              // 获取认证token
              const token = localStorage.getItem("authToken");
              if (!token) {
                showErrorToast("用户未登录");
                return;
              }

              // 调用后端API修改密码
              fetch(`${apiBaseUrl}/api/auth/change-password`, {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  Authorization: `Bearer ${token}`,
                },
                body: JSON.stringify({
                  oldPassword: currentPassword,
                  newPassword,
                }),
              })
                .then((response) => response.json())
                .then((data) => {
                  if (data.success) {
                    // 显示成功消息
                    showToast("密码修改成功");

                    // 清空表单
                    passwordForm.reset();

                    // 关闭模态框
                    closeModalFunc();
                  } else {
                    showErrorToast(data.message || "密码修改失败");
                  }
                })
                .catch((error) => {
                  console.error("密码修改错误:", error);
                  showErrorToast("密码修改过程中发生错误，请稍后重试");
                });
            }
          });
        }

        // 保存昵称按钮点击事件
        if (saveNicknameBtn) {
          saveNicknameBtn.addEventListener("click", async function () {
            if (
              nicknameInput.value.trim() &&
              nicknameInput.value !== originalNickname
            ) {
              try {
                // 获取认证token
                const token = localStorage.getItem("authToken");
                if (!token) {
                  showErrorToast("用户未登录");
                  nicknameInput.value = originalNickname; // 恢复原值
                  return;
                }

                console.log("正在更新昵称:", nicknameInput.value.trim());

                // 调用后端API更新昵称
                const response = await fetch(`${apiBaseUrl}/api/auth/update`, {
                  method: "PUT",
                  headers: {
                    "Content-Type": "application/json",
                    Authorization: `Bearer ${token}`,
                  },
                  body: JSON.stringify({
                    nickname: nicknameInput.value.trim(),
                  }),
                });

                const data = await response.json();
                console.log("昵称更新响应:", data);

                if (data.success) {
                  // 更新localStorage中的昵称
                  localStorage.setItem(
                    "userNickname",
                    nicknameInput.value.trim(),
                  );
                  // 更新头部显示的昵称
                  if (nicknameHeader) {
                    nicknameHeader.textContent = nicknameInput.value.trim();
                  }
                  showToast("昵称修改成功！");
                  originalNickname = nicknameInput.value.trim();
                } else {
                  showErrorToast(data.message || "昵称修改失败");
                  nicknameInput.value = originalNickname; // 恢复原值
                }
              } catch (error) {
                console.error("昵称修改错误:", error);
                showErrorToast("昵称修改过程中发生错误，请稍后重试");
                nicknameInput.value = originalNickname; // 恢复原值
              }
            } else if (nicknameInput.value.trim() === "") {
              showErrorToast("昵称不能为空");
            } else if (nicknameInput.value === originalNickname) {
              showToast("昵称未发生变化");
            }
          });
        }

        // 昵称输入框回车键事件（触发保存）
        if (nicknameInput) {
          nicknameInput.addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              e.preventDefault(); // 防止表单提交
              if (saveNicknameBtn) {
                saveNicknameBtn.click(); // 触发保存按钮点击事件
              }
            }
          });
        }

        // 为表单输入框添加输入事件，移除错误样式
        document.querySelectorAll("input").forEach((input) => {
          input.addEventListener("input", function () {
            this.classList.remove("border-red-500");
          });
        });
      });

      // 深色模式初始化函数
      function initDarkMode() {
        // 从localStorage获取主题设置
        const savedTheme = localStorage.getItem("theme");

        // 如果有保存的主题设置，则应用它
        if (savedTheme === "dark") {
          document.documentElement.classList.add("dark");
          document.body.classList.add("dark");
        }
      }
    </script>
  </body>
</html>
